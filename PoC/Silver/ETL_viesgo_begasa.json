{"paragraphs":[{"text":"%md\n#### This notebook reads CSV files for supply poins (ps) and consumptions (cons) of Viesgo - Begasa electricity distributors and extracts information into data frames\n","user":"anonymous","dateUpdated":"2023-05-23T10:25:45+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>This notebook reads CSV files for supply poins (ps) and consumptions (cons) of Viesgo - Begasa electricity distributors and extracts information into data frames</h4>\n"}]},"apps":[],"jobName":"paragraph_1684790862951_-1973197021","id":"20230522-232742_1288950877","dateCreated":"2023-05-22T23:27:42+0200","dateStarted":"2023-05-23T10:25:45+0200","dateFinished":"2023-05-23T10:25:45+0200","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2884"},{"text":"%spark\nimport org.apache.spark.sql.{SparkSession, DataFrame}\nimport org.apache.spark.sql.functions._\nimport org.apache.spark.sql.types._\nimport java.sql.Timestamp\nimport java.text.SimpleDateFormat","user":"anonymous","dateUpdated":"2023-05-23T09:52:17+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.{SparkSession, DataFrame}\nimport org.apache.spark.sql.functions._\nimport org.apache.spark.sql.types._\nimport java.sql.Timestamp\nimport java.text.SimpleDateFormat"}]},"apps":[],"jobName":"paragraph_1684602181426_-991189644","id":"20230520-190301_2034857428","dateCreated":"2023-05-20T19:03:01+0200","dateStarted":"2023-05-23T09:52:17+0200","dateFinished":"2023-05-23T09:52:18+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2885"},{"text":"%md\n###Extract and Transformation of **supply points (ps)** for Viesgo and Begasa\n","user":"anonymous","dateUpdated":"2023-05-23T10:26:12+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Extract and Transformation of <strong>supply points (ps)</strong> for Viesgo and Begasa</h3>\n"}]},"apps":[],"jobName":"paragraph_1684691609921_-254156206","id":"20230521-195329_1338340912","dateCreated":"2023-05-21T19:53:29+0200","dateStarted":"2023-05-23T10:26:12+0200","dateFinished":"2023-05-23T10:26:12+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2886"},{"text":"\n%spark\nval viesgoPsPathRaw = \"/user/training/adriana/raw/VIESGO/VIESGO/Punto_Suministro_20180105.csv\"\nval begasaPsPathRaw = \"/user/training/adriana/raw/VIESGO/BEGASA/Punto_Suministro_20180106.csv\"","user":"anonymous","dateUpdated":"2023-05-23T09:52:30+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"viesgoPsPathRaw: String = /user/training/adriana/raw/VIESGO/VIESGO/Punto_Suministro_20180105.csv\nbegasaPsPathRaw: String = /user/training/adriana/raw/VIESGO/BEGASA/Punto_Suministro_20180106.csv"}]},"apps":[],"jobName":"paragraph_1684602202964_1618883632","id":"20230520-190322_659280236","dateCreated":"2023-05-20T19:03:22+0200","dateStarted":"2023-05-23T09:52:30+0200","dateFinished":"2023-05-23T09:52:31+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2887"},{"text":"%spark\nval viesgoPsInitialDF = spark.read.option(\"header\", \"true\").option(\"sep\", \";\").option(\"encoding\", \"iso-8859-1\").csv(viesgoPsPathRaw)\nval begasaPsInitialDF = spark.read.option(\"header\", \"true\").option(\"sep\", \";\").option(\"encoding\", \"iso-8859-1\").csv(begasaPsPathRaw)","user":"anonymous","dateUpdated":"2023-05-23T09:52:34+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"viesgoPsInitialDF: org.apache.spark.sql.DataFrame = [CUPS: string, EMPRESA_DISTRIBUIDORA: string ... 36 more fields]\nbegasaPsInitialDF: org.apache.spark.sql.DataFrame = [CUPS: string, EMPRESA_DISTRIBUIDORA: string ... 36 more fields]"}]},"apps":[],"jobName":"paragraph_1684690226457_-856886151","id":"20230521-193026_1063937142","dateCreated":"2023-05-21T19:30:26+0200","dateStarted":"2023-05-23T09:52:34+0200","dateFinished":"2023-05-23T09:52:35+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2888"},{"text":"%spark\n//check if viesgoPsInitialDF and begasaPsInitialDF have the same structure\nval columnsPsViesgo = viesgoPsInitialDF.columns.toSet\nval columnsPsBegasa = begasaPsInitialDF.columns.toSet\n\nif (columnsPsViesgo != columnsPsBegasa) {\n  println(\"Column structures do not match\")\n}","user":"anonymous","dateUpdated":"2023-05-23T09:52:37+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"columnsPsViesgo: scala.collection.immutable.Set[String] = Set(FH_ULTIMO_CAMBIO_COMERC, MUNICIPIO, IMPORTE_GARANTIA, PROVINCIA, POT_CONTRATADA_P6, ICP_INSTALADO, DERECHOS_EXTENSION, PROPIEDAD_ICP_TITULAR, TARIFA_ATR, POT_CONTRATADA_P2, COD_POSTAL, TIPO_FRONTERA, POBLACION, TIPO_TELEGESTION, PROPIEDAD_EQ_MEDIDA_TITULAR, FH_LIMITE_DERECHOS_EXT, FH_ULTIMA_LECTURA, EMPRESA_DISTRIBUIDORA, POT_CONTRATADA_P3, FH_ALTA_SUMINISTRO, CUPS, POT_MAX_BIE, POT_MAX_ACTA, DH, POT_CONTRATADA_P4, PERSONA_FISICA, COMERCIALIZADORA, VIVIENDA_HABITUAL, CODIGO_FASES, TENSION, DERECHOS_CONSUMO, FH_ULTIMO_MOV_CONTRAT, TIPO_PERFIL_CONSUMO, BONO_SOCIAL, POT_CONTRATADA_P1, IMPAGOS, CODIGO_AUTOCONSUMO, POT_CONTRATADA_P5)\ncolumnsPsBegasa: scala.collection.immutable.Set[String] = Set(FH_ULTIMO_CAMBIO_COMERC, MUNICIPIO, IMPORTE_GARANTIA, PROVINCIA, POT_CONTRATADA_P6, ICP_INSTALADO, DERECHOS_EXTENSION, PROPIEDAD_ICP_TITULAR, TARIFA_ATR, POT_CONTRATADA_P2, COD_POSTAL, TIPO_FRONTERA, POBLACION, TIPO_TELEGESTION, PROPIEDAD_EQ_MEDIDA_TITULAR, FH_LIMITE_DERECHOS_EXT, FH_ULTIMA_LECTURA, EMPRESA_DISTRIBUIDORA, POT_CONTRATADA_P3, FH_ALTA_SUMINISTRO, CUPS, POT_MAX_BIE, POT_MAX_ACTA, DH, POT_CONTRATADA_P4, PERSONA_FISICA, COMERCIALIZADORA, VIVIENDA_HABITUAL, CODIGO_FASES, TENSION, DERECHOS_CONSUMO, FH_ULTIMO_MOV_CONTRAT, TIPO_PERFIL_CONSUMO, BONO_SOCIAL, POT_CONTRATADA_P1, IMPAGOS, CODIGO_AUTOCONSUMO, POT_CONTRATADA_P5)"}]},"apps":[],"jobName":"paragraph_1684690112300_758280149","id":"20230521-192832_597287842","dateCreated":"2023-05-21T19:28:32+0200","dateStarted":"2023-05-23T09:52:37+0200","dateFinished":"2023-05-23T09:52:38+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2889"},{"text":"%spark\nval schemaPs = StructType(Array(  \n\t  StructField(\"cups\", StringType,  nullable = true), \n\t  StructField(\"distribuidora\",StringType,  nullable = true), \n\t  StructField(\"codpostal\", StringType,  nullable = true), \n\t  StructField(\"poblacion\", StringType,  nullable = true), \n\t  StructField(\"municipio\", StringType,  nullable = true), \n\t  StructField(\"provincia\", StringType,  nullable = true), \n\t  StructField(\"falta\", StringType,  nullable = true), \n\t  StructField(\"tarifa\", StringType,  nullable = true), \n\t  StructField(\"tensionps\", StringType,  nullable = true), \n\t  StructField(\"potmaxbie\", StringType,  nullable = true), \n\t  StructField(\"potmaxp1\", DoubleType,  nullable = true), \n\t  StructField(\"tipo_frontera\", StringType,  nullable = true), \n\t  StructField(\"icp_instalado\",StringType,  nullable = true), \n\t  StructField(\"perfilree\", StringType,  nullable = true), \n\t  StructField(\"dh\", StringType,  nullable = true), \n\t  StructField(\"derext\", DoubleType,  nullable = true), \n\t  StructField(\"deraccll\", DoubleType,  nullable = true), \n\t  StructField(\"propiedad_eq_medida_titular\", StringType,  nullable = true), \n\t  StructField(\"propiedad_icp_titular\", StringType,  nullable = true), \n\t  StructField(\"potcontrp1\", DoubleType,  nullable = true), \n\t  StructField(\"potcontrp2\", DoubleType,  nullable = true), \n\t  StructField(\"potcontrp3\", DoubleType,  nullable = true), \n\t  StructField(\"potcontrp4\", DoubleType,  nullable = true), \n\t  StructField(\"potcontrp5\", DoubleType,  nullable = true), \n\t  StructField(\"potcontrp6\", DoubleType,  nullable = true), \n\t  StructField(\"fh_ultimo_mov_contrat\", StringType,  nullable = true), \n\t  StructField(\"fh_ultimo_cambio_comerc\", StringType,  nullable = true), \n\t  StructField(\"fh_limite_derechos_ext\", StringType,  nullable = true), \n\t  StructField(\"fh_ultima_lectura\", StringType,  nullable = true), \n\t  StructField(\"impagos\", StringType,  nullable = true), \n\t  StructField(\"importe_garantia\", StringType,  nullable = true), \n\t  StructField(\"persona_fisica\", StringType,  nullable = true), \n\t  StructField(\"vivienda_habitual\", StringType,  nullable = true), \n\t  StructField(\"comercializadora\", StringType,  nullable = true), \n\t  StructField(\"tipo_telegestion\", StringType,  nullable = true), \n\t  StructField(\"fases\", StringType,  nullable = true), \n\t  StructField(\"autoconsumo\", StringType,  nullable = true), \n\t  StructField(\"bono_social\", StringType,  nullable = true) \n\t)\n)","user":"anonymous","dateUpdated":"2023-05-23T09:52:47+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"schemaPs: org.apache.spark.sql.types.StructType = StructType(StructField(cups,StringType,true), StructField(distribuidora,StringType,true), StructField(codpostal,StringType,true), StructField(poblacion,StringType,true), StructField(municipio,StringType,true), StructField(provincia,StringType,true), StructField(falta,StringType,true), StructField(tarifa,StringType,true), StructField(tensionps,StringType,true), StructField(potmaxbie,StringType,true), StructField(potmaxp1,DoubleType,true), StructField(tipo_frontera,StringType,true), StructField(icp_instalado,StringType,true), StructField(perfilree,StringType,true), StructField(dh,StringType,true), StructField(derext,DoubleType,true), StructField(deraccll,DoubleType,true), StructField(propiedad_eq_medida_titular,StringType,true), StructFiel..."}]},"apps":[],"jobName":"paragraph_1684602934299_322200230","id":"20230520-191534_1937913910","dateCreated":"2023-05-20T19:15:34+0200","dateStarted":"2023-05-23T09:52:47+0200","dateFinished":"2023-05-23T09:52:48+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2890"},{"text":"%spark\n//read the CSV files, apply the schema for the dataframes structure and sets a specific reading encoding \n val viesgoPsDF = spark.read.schema(schemaPs).option(\"header\", \"true\").option(\"sep\", \";\").option(\"encoding\", \"iso-8859-1\").csv(viesgoPsPathRaw)\n val begasaPsDF = spark.read.schema(schemaPs).option(\"header\", \"true\").option(\"sep\", \";\").option(\"encoding\", \"iso-8859-1\").csv(begasaPsPathRaw)\n","user":"anonymous","dateUpdated":"2023-05-23T09:52:53+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"viesgoPsDF: org.apache.spark.sql.DataFrame = [cups: string, distribuidora: string ... 36 more fields]\nbegasaPsDF: org.apache.spark.sql.DataFrame = [cups: string, distribuidora: string ... 36 more fields]"}]},"apps":[],"jobName":"paragraph_1684610513759_-299517488","id":"20230520-212153_374058527","dateCreated":"2023-05-20T21:21:53+0200","dateStarted":"2023-05-23T09:52:53+0200","dateFinished":"2023-05-23T09:52:54+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2891"},{"text":"%spark\n//Create a data frame from the join of the data of Viesgo and Begasa for the supply points (Ps)\nval viesgoBegasaPsDF = viesgoPsDF.union(begasaPsDF)","user":"anonymous","dateUpdated":"2023-05-23T09:52:56+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"viesgoBegasaPsDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [cups: string, distribuidora: string ... 36 more fields]"}]},"apps":[],"jobName":"paragraph_1684690840117_-416292066","id":"20230521-194040_1433523038","dateCreated":"2023-05-21T19:40:40+0200","dateStarted":"2023-05-23T09:52:56+0200","dateFinished":"2023-05-23T09:52:57+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2892"},{"text":"%spark\nviesgoBegasaPsDF.printSchema()","user":"anonymous","dateUpdated":"2023-05-23T09:53:00+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- cups: string (nullable = true)\n |-- distribuidora: string (nullable = true)\n |-- codpostal: string (nullable = true)\n |-- poblacion: string (nullable = true)\n |-- municipio: string (nullable = true)\n |-- provincia: string (nullable = true)\n |-- falta: string (nullable = true)\n |-- tarifa: string (nullable = true)\n |-- tensionps: string (nullable = true)\n |-- potmaxbie: string (nullable = true)\n |-- potmaxp1: double (nullable = true)\n |-- tipo_frontera: string (nullable = true)\n |-- icp_instalado: string (nullable = true)\n |-- perfilree: string (nullable = true)\n |-- dh: string (nullable = true)\n |-- derext: double (nullable = true)\n |-- deraccll: double (nullable = true)\n |-- propiedad_eq_medida_titular: string (nullable = true)\n |-- propiedad_icp_titular: string (nullable = true)\n |-- potcontrp1: double (nullable = true)\n |-- potcontrp2: double (nullable = true)\n |-- potcontrp3: double (nullable = true)\n |-- potcontrp4: double (nullable = true)\n |-- potcontrp5: double (nullable = true)\n |-- potcontrp6: double (nullable = true)\n |-- fh_ultimo_mov_contrat: string (nullable = true)\n |-- fh_ultimo_cambio_comerc: string (nullable = true)\n |-- fh_limite_derechos_ext: string (nullable = true)\n |-- fh_ultima_lectura: string (nullable = true)\n |-- impagos: string (nullable = true)\n |-- importe_garantia: string (nullable = true)\n |-- persona_fisica: string (nullable = true)\n |-- vivienda_habitual: string (nullable = true)\n |-- comercializadora: string (nullable = true)\n |-- tipo_telegestion: string (nullable = true)\n |-- fases: string (nullable = true)\n |-- autoconsumo: string (nullable = true)\n |-- bono_social: string (nullable = true)"}]},"apps":[],"jobName":"paragraph_1684602924586_553103180","id":"20230520-191524_1492144967","dateCreated":"2023-05-20T19:15:24+0200","dateStarted":"2023-05-23T09:53:00+0200","dateFinished":"2023-05-23T09:53:01+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2893"},{"text":"%spark\nviesgoBegasaPsDF.count()\nviesgoBegasaPsDF.show(false)","user":"anonymous","dateUpdated":"2023-05-23T09:53:06+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res98: Long = 19998\n+----------------------+------------------------------------------+---------+---------------------------+---------------------------+---------+----------+------+---------+---------+--------+-------------+----------------+---------+----+------+--------+-------------------------------+-------------------------------+----------+----------+----------+----------+----------+----------+---------------------+-----------------------+----------------------+-----------------+-------+----------------+--------------+-----------------+----------------+----------------+-----+-----------+-----------+\n|cups                  |distribuidora                             |codpostal|poblacion                  |municipio                  |provincia|falta     |tarifa|tensionps|potmaxbie|potmaxp1|tipo_frontera|icp_instalado   |perfilree|dh  |derext|deraccll|propiedad_eq_medida_titular    |propiedad_icp_titular          |potcontrp1|potcontrp2|potcontrp3|potcontrp4|potcontrp5|potcontrp6|fh_ultimo_mov_contrat|fh_ultimo_cambio_comerc|fh_limite_derechos_ext|fh_ultima_lectura|impagos|importe_garantia|persona_fisica|vivienda_habitual|comercializadora|tipo_telegestion|fases|autoconsumo|bono_social|\n+----------------------+------------------------------------------+---------+---------------------------+---------------------------+---------+----------+------+---------+---------+--------+-------------+----------------+---------+----+------+--------+-------------------------------+-------------------------------+----------+----------+----------+----------+----------+----------+---------------------+-----------------------+----------------------+-----------------+-------+----------------+--------------+-----------------+----------------+----------------+-----+-----------+-----------+\n|ES0027460000000003KD0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|39292    |COSTANA (LA)               |CAMPOO DE YUSO             |Cantabria|02/11/2011|2.0A  |230 V    |9.2      |null    |5            |Icp instalado   |Pa       |NO  |6.9   |null    |null                           |null                           |6.9       |0.0       |0.0       |0.0       |0.0       |0.0       |28/11/2011           |null                   |31/12/9999            |06/12/2017       |NO     |null            |F             |null             |R2-243          |01              |M    |00         |NO         |\n|ES0027460000000006KN0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|39479    |VIOÑO                      |PIELAGOS                   |Cantabria|10/11/2011|null  |230 V    |9.2      |null    |null         |null            |null     |null|9.2   |9.2     |null                           |null                           |null      |null      |null      |null      |null      |null      |17/05/2012           |null                   |16/05/2015            |02/01/2012       |null   |null            |null          |null             |null            |null            |null |00         |NO         |\n|ES0027460000000007KJ0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|39750    |COLINDRES                  |COLINDRES                  |Cantabria|02/11/2011|2.0A  |230 V    |5.75     |null    |5            |Icp instalado   |Pa       |NO  |0.0   |null    |Titular del punto de suministro|Empresa distribuidora          |5.75      |0.0       |0.0       |0.0       |0.0       |0.0       |25/11/2011           |null                   |31/12/9999            |01/01/2018       |NO     |null            |F             |null             |R2-243          |01              |M    |00         |NO         |\n|ES0027460000000008KZ0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|39593    |ROIZ                       |VALDALIGA                  |Cantabria|03/11/2011|2.0A  |230 V    |5.75     |null    |5            |Icp instalado   |Pa       |NO  |5.75  |4.6     |Empresa distribuidora          |Empresa distribuidora          |4.6       |0.0       |0.0       |0.0       |0.0       |0.0       |13/01/2012           |null                   |12/01/2015            |08/12/2017       |NO     |null            |F             |null             |R2-243          |01              |M    |00         |NO         |\n|ES0027460000000011KV0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|33670    |MOREDA (MOREDA)            |ALLER                      |Asturias |null      |null  |230 V    |null     |null    |null         |null            |null     |null|0.0   |null    |null                           |null                           |null      |null      |null      |null      |null      |null      |null                 |null                   |31/12/9999            |null             |NO     |null            |null          |null             |null            |null            |null |00         |null       |\n|ES0027460000000012KH0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|33611    |SANTULLANO (SANTULLANO)    |MIERES                     |Asturias |23/11/2011|6.1B  |30 KV    |1730     |0.0     |2            |Icp instalado   |null     |DH6 |4114.0|2572.0  |Titular del punto de suministro|null                           |940.0     |940.0     |940.0     |940.0     |940.0     |2572.0    |01/01/2018           |01/01/2018             |23/07/2017            |30/11/2017       |NO     |null            |J             |null             |R2-416          |03              |T    |00         |NO         |\n|ES0027460000000013KL0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|33639    |CAMPOS, LOS (POLA DE LENA) |LENA                       |Asturias |03/11/2011|2.0A  |230 V    |5.75     |null    |5            |Icp instalado   |Pa       |NO  |0.0   |null    |Titular del punto de suministro|Titular del punto de suministro|4.6       |0.0       |0.0       |0.0       |0.0       |0.0       |24/11/2011           |null                   |31/12/9999            |09/12/2017       |NO     |null            |F             |null             |R2-243          |01              |M    |00         |NO         |\n|ES0027460000000014KC0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|33610    |TURON                      |MIERES                     |Asturias |03/11/2011|2.0A  |230 V    |3.68     |null    |5            |Icp instalado   |Pa       |NO  |0.0   |null    |Titular del punto de suministro|Titular del punto de suministro|3.45      |0.0       |0.0       |0.0       |0.0       |0.0       |04/10/2014           |04/10/2014             |31/12/9999            |09/12/2017       |NO     |null            |F             |null             |R2-001          |01              |M    |00         |NO         |\n|ES0027460000000021EG0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|39600    |MURIEDAS                   |CAMARGO                    |Cantabria|04/11/2011|2.0A  |230 V    |9.2      |null    |5            |Icp instalado   |Pa       |NO  |5.75  |null    |Empresa distribuidora          |null                           |5.75      |0.0       |0.0       |0.0       |0.0       |0.0       |01/07/2014           |01/07/2014             |31/12/9999            |05/12/2017       |NO     |null            |J             |null             |R2-515          |01              |M    |00         |NO         |\n|ES0027460000000022EM0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|39100    |SANTA CRUZ DE BEZANA       |SANTA CRUZ DE BEZANA       |Cantabria|04/11/2011|3.0A  |3X230/400|43.648   |null    |4            |Icp no instalado|Pc       |DH3 |43.648|43.648  |Empresa distribuidora          |Titular del punto de suministro|36.769    |36.769    |43.648    |0.0       |0.0       |0.0       |03/10/2017           |03/10/2017             |31/12/9999            |02/12/2017       |NO     |null            |J             |null             |R2-506          |02              |T    |00         |NO         |\n|ES0027460000000023EY0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|09108    |REZMONDO                   |REZMONDO                   |Burgos   |04/11/2011|null  |230 V    |5.75     |null    |null         |null            |null     |null|5.75  |3.45    |null                           |null                           |null      |null      |null      |null      |null      |null      |12/06/2013           |null                   |11/06/2016            |29/12/2011       |null   |null            |null          |null             |null            |null            |null |00         |NO         |\n|ES0027460000000024EF0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|34400    |HERRERA DE PISUERGA        |HERRERA DE PISUERGA        |Palencia |04/11/2011|3.0A  |3X230/400|125      |null    |3            |Icp no instalado|Pc       |DH3 |125.0 |null    |Empresa distribuidora          |Titular del punto de suministro|63.0      |63.0      |63.0      |0.0       |0.0       |0.0       |21/11/2017           |null                   |31/12/9999            |30/11/2017       |NO     |414.98          |J             |null             |R2-243          |03              |T    |00         |NO         |\n|ES0027460000000025EP0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|39210    |ABIADA                     |HERMANDAD DE CAMPOO DE SUSO|Cantabria|04/11/2011|2.0A  |230 V    |9.2      |null    |5            |Icp instalado   |Pa       |NO  |5.75  |null    |Empresa distribuidora          |Empresa distribuidora          |5.75      |0.0       |0.0       |0.0       |0.0       |0.0       |06/03/2014           |null                   |31/12/9999            |06/12/2017       |NO     |30.89           |F             |null             |R2-243          |01              |M    |00         |NO         |\n|ES0027460000000026ED0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|39210    |ABIADA                     |HERMANDAD DE CAMPOO DE SUSO|Cantabria|04/11/2011|null  |230 V    |5.75     |null    |null         |null            |null     |null|0.0   |null    |null                           |null                           |null      |null      |null      |null      |null      |null      |06/03/2014           |null                   |05/03/2017            |02/12/2011       |null   |null            |null          |null             |null            |null            |null |00         |NO         |\n|ES0027460000000027EX0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|33600    |MIERES (MIERES (PARROQUIA))|MIERES                     |Asturias |23/12/2011|null  |230 V    |11.5     |null    |null         |null            |null     |null|5.75  |null    |null                           |null                           |null      |null      |null      |null      |null      |null      |02/03/2012           |null                   |01/03/2015            |null             |null   |null            |null          |null             |null            |null            |null |00         |NO         |\n|ES0027460000000031EZ0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|33700    |VILLAR (LUARCA(PARROQUIA)) |VALDES                     |Asturias |04/11/2011|2.0DHA|230V     |9.2      |null    |5            |Icp instalado   |Pb       |SI  |4.6   |4.6     |Empresa distribuidora          |Empresa distribuidora          |4.6       |0.0       |0.0       |0.0       |0.0       |0.0       |28/12/2017           |null                   |31/12/9999            |17/11/2017       |NO     |null            |F             |N                |R2-243          |03              |M    |00         |NO         |\n|ES0027460000000034EV0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|39012    |MONTE                      |SANTANDER                  |Cantabria|04/11/2011|2.0A  |230 V    |6.9      |null    |5            |Icp instalado   |Pa       |NO  |5.75  |6.9     |Empresa distribuidora          |Empresa distribuidora          |6.9       |0.0       |0.0       |0.0       |0.0       |0.0       |28/11/2014           |null                   |27/11/2014            |03/12/2017       |NO     |6.18            |F             |null             |R2-243          |02              |M    |00         |NO         |\n|ES0027460000000035EH0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|33617    |PEÑA, LA (LA PEÑA)         |MIERES                     |Asturias |07/11/2011|2.0DHA|230 V    |5.75     |null    |5            |Icp instalado   |Pa       |SI  |0.0   |null    |Empresa distribuidora          |Empresa distribuidora          |5.75      |0.0       |0.0       |0.0       |0.0       |0.0       |18/03/2015           |null                   |17/03/2015            |09/12/2017       |NO     |null            |F             |null             |R2-243          |01              |M    |00         |NO         |\n|ES0027460000000036EL0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|33700    |ALMUÑA (LUARCA(PARROQUIA)) |VALDES                     |Asturias |null      |null  |230 V    |null     |null    |null         |null            |null     |null|5.75  |null    |null                           |null                           |null      |null      |null      |null      |null      |null      |null                 |null                   |31/12/9999            |null             |NO     |null            |null          |null             |null            |null            |null |00         |null       |\n|ES0027460000000037EC0F|0027 - VIESGO DISTRIBUCION ELECTRICA, S.L.|33770    |VEGADEO (VEGADEO)          |VEGADEO                    |Asturias |null      |null  |230 V    |null     |null    |null         |null            |null     |null|9.2   |null    |null                           |null                           |null      |null      |null      |null      |null      |null      |null                 |null                   |31/12/9999            |null             |NO     |null            |null          |null             |null            |null            |null |00         |null       |\n+----------------------+------------------------------------------+---------+---------------------------+---------------------------+---------+----------+------+---------+---------+--------+-------------+----------------+---------+----+------+--------+-------------------------------+-------------------------------+----------+----------+----------+----------+----------+----------+---------------------+-----------------------+----------------------+-----------------+-------+----------------+--------------+-----------------+----------------+----------------+-----+-----------+-----------+\nonly showing top 20 rows"}]},"apps":[],"jobName":"paragraph_1684690893047_608854928","id":"20230521-194133_1191311628","dateCreated":"2023-05-21T19:41:33+0200","dateStarted":"2023-05-23T09:53:06+0200","dateFinished":"2023-05-23T09:53:07+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2894"},{"text":"%spark\n//check for duplicates\nviesgoBegasaPsDF.count()\nviesgoBegasaPsDF.dropDuplicates().count()","user":"anonymous","dateUpdated":"2023-05-23T09:53:14+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res106: Long = 19998\nres107: Long = 19998"}]},"apps":[],"jobName":"paragraph_1684603020470_1673580825","id":"20230520-191700_754830947","dateCreated":"2023-05-20T19:17:00+0200","dateStarted":"2023-05-23T09:53:14+0200","dateFinished":"2023-05-23T09:53:17+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2895"},{"text":"%spark\n//viesgoBegasaPsDFClean does:\n//Extracts the coddist and the name of the distributor from the 'distribuidora' column with the split function\n//Remove the characters K and V from the 'tensionps' column using the regexp_replace function and cast this field to an integer type\n//Converts the string dd/MM/yyyy to timestamp type using the to_timestamp function and changes its format to \"yyyyMMdd\" with the date_format function\n","user":"anonymous","dateUpdated":"2023-05-23T10:17:17+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1684824324125_1459945568","id":"20230523-084524_659132090","dateCreated":"2023-05-23T08:45:24+0200","dateStarted":"2023-05-23T09:53:11+0200","dateFinished":"2023-05-23T09:53:12+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2896"},{"text":"%spark\nval viesgoBegasaPsDFClean = (viesgoBegasaPsDF.withColumn(\"coddist\", split($\"distribuidora\", \" - \").getItem(0)).withColumn(\"distribuidora\", split($\"distribuidora\", \" - \").getItem(1))\n                        .withColumn(\"tensionps\", regexp_replace($\"tensionps\", \"[KV]\", \"\")).withColumn(\"tensionps\", $\"tensionps\".cast(IntegerType))\n                        .withColumn(\"falta\", to_timestamp($\"falta\", \"dd/MM/yyyy\")).withColumn(\"falta\", date_format($\"falta\", \"yyyyMMdd\") as \"falta\")\n                        .withColumn(\"fh_ultimo_mov_contrat\", to_timestamp($\"fh_ultimo_mov_contrat\", \"dd/MM/yyyy\")).withColumn(\"fh_ultimo_mov_contrat\", date_format($\"fh_ultimo_mov_contrat\", \"yyyyMMdd\") as \"fh_ultimo_mov_contrat\")\n                        .withColumn(\"fh_ultimo_cambio_comerc\", to_timestamp($\"fh_ultimo_cambio_comerc\", \"dd/MM/yyyy\")).withColumn(\"fh_ultimo_cambio_comerc\", date_format($\"fh_ultimo_cambio_comerc\", \"yyyyMMdd\") as \"fh_ultimo_cambio_comerc\")\n                        .withColumn(\"fh_limite_derechos_ext\", to_timestamp($\"fh_limite_derechos_ext\", \"dd/MM/yyyy\")).withColumn(\"fh_limite_derechos_ext\", date_format($\"fh_limite_derechos_ext\", \"yyyyMMdd\") as \"fh_limite_derechos_ext\")\n                        .withColumn(\"fh_ultima_lectura\", to_timestamp($\"fh_ultima_lectura\", \"dd/MM/yyyy\")).withColumn(\"fh_ultima_lectura\", date_format($\"fh_ultima_lectura\", \"yyyyMMdd\") as \"fh_ultima_lectura\")\n                        )\nviesgoBegasaPsDFClean.show(false)","user":"anonymous","dateUpdated":"2023-05-23T09:53:19+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"viesgoBegasaPsDFClean: org.apache.spark.sql.DataFrame = [cups: string, distribuidora: string ... 37 more fields]\n+----------------------+-----------------------------------+---------+---------------------------+---------------------------+---------+--------+------+---------+---------+--------+-------------+----------------+---------+----+------+--------+-------------------------------+-------------------------------+----------+----------+----------+----------+----------+----------+---------------------+-----------------------+----------------------+-----------------+-------+----------------+--------------+-----------------+----------------+----------------+-----+-----------+-----------+-------+\n|cups                  |distribuidora                      |codpostal|poblacion                  |municipio                  |provincia|falta   |tarifa|tensionps|potmaxbie|potmaxp1|tipo_frontera|icp_instalado   |perfilree|dh  |derext|deraccll|propiedad_eq_medida_titular    |propiedad_icp_titular          |potcontrp1|potcontrp2|potcontrp3|potcontrp4|potcontrp5|potcontrp6|fh_ultimo_mov_contrat|fh_ultimo_cambio_comerc|fh_limite_derechos_ext|fh_ultima_lectura|impagos|importe_garantia|persona_fisica|vivienda_habitual|comercializadora|tipo_telegestion|fases|autoconsumo|bono_social|coddist|\n+----------------------+-----------------------------------+---------+---------------------------+---------------------------+---------+--------+------+---------+---------+--------+-------------+----------------+---------+----+------+--------+-------------------------------+-------------------------------+----------+----------+----------+----------+----------+----------+---------------------+-----------------------+----------------------+-----------------+-------+----------------+--------------+-----------------+----------------+----------------+-----+-----------+-----------+-------+\n|ES0027460000000003KD0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|39292    |COSTANA (LA)               |CAMPOO DE YUSO             |Cantabria|20111102|2.0A  |null     |9.2      |null    |5            |Icp instalado   |Pa       |NO  |6.9   |null    |null                           |null                           |6.9       |0.0       |0.0       |0.0       |0.0       |0.0       |20111128             |null                   |99991231              |20171206         |NO     |null            |F             |null             |R2-243          |01              |M    |00         |NO         |0027   |\n|ES0027460000000006KN0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|39479    |VIOÑO                      |PIELAGOS                   |Cantabria|20111110|null  |null     |9.2      |null    |null         |null            |null     |null|9.2   |9.2     |null                           |null                           |null      |null      |null      |null      |null      |null      |20120517             |null                   |20150516              |20120102         |null   |null            |null          |null             |null            |null            |null |00         |NO         |0027   |\n|ES0027460000000007KJ0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|39750    |COLINDRES                  |COLINDRES                  |Cantabria|20111102|2.0A  |null     |5.75     |null    |5            |Icp instalado   |Pa       |NO  |0.0   |null    |Titular del punto de suministro|Empresa distribuidora          |5.75      |0.0       |0.0       |0.0       |0.0       |0.0       |20111125             |null                   |99991231              |20180101         |NO     |null            |F             |null             |R2-243          |01              |M    |00         |NO         |0027   |\n|ES0027460000000008KZ0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|39593    |ROIZ                       |VALDALIGA                  |Cantabria|20111103|2.0A  |null     |5.75     |null    |5            |Icp instalado   |Pa       |NO  |5.75  |4.6     |Empresa distribuidora          |Empresa distribuidora          |4.6       |0.0       |0.0       |0.0       |0.0       |0.0       |20120113             |null                   |20150112              |20171208         |NO     |null            |F             |null             |R2-243          |01              |M    |00         |NO         |0027   |\n|ES0027460000000011KV0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|33670    |MOREDA (MOREDA)            |ALLER                      |Asturias |null    |null  |null     |null     |null    |null         |null            |null     |null|0.0   |null    |null                           |null                           |null      |null      |null      |null      |null      |null      |null                 |null                   |99991231              |null             |NO     |null            |null          |null             |null            |null            |null |00         |null       |0027   |\n|ES0027460000000012KH0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|33611    |SANTULLANO (SANTULLANO)    |MIERES                     |Asturias |20111123|6.1B  |null     |1730     |0.0     |2            |Icp instalado   |null     |DH6 |4114.0|2572.0  |Titular del punto de suministro|null                           |940.0     |940.0     |940.0     |940.0     |940.0     |2572.0    |20180101             |20180101               |20170723              |20171130         |NO     |null            |J             |null             |R2-416          |03              |T    |00         |NO         |0027   |\n|ES0027460000000013KL0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|33639    |CAMPOS, LOS (POLA DE LENA) |LENA                       |Asturias |20111103|2.0A  |null     |5.75     |null    |5            |Icp instalado   |Pa       |NO  |0.0   |null    |Titular del punto de suministro|Titular del punto de suministro|4.6       |0.0       |0.0       |0.0       |0.0       |0.0       |20111124             |null                   |99991231              |20171209         |NO     |null            |F             |null             |R2-243          |01              |M    |00         |NO         |0027   |\n|ES0027460000000014KC0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|33610    |TURON                      |MIERES                     |Asturias |20111103|2.0A  |null     |3.68     |null    |5            |Icp instalado   |Pa       |NO  |0.0   |null    |Titular del punto de suministro|Titular del punto de suministro|3.45      |0.0       |0.0       |0.0       |0.0       |0.0       |20141004             |20141004               |99991231              |20171209         |NO     |null            |F             |null             |R2-001          |01              |M    |00         |NO         |0027   |\n|ES0027460000000021EG0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|39600    |MURIEDAS                   |CAMARGO                    |Cantabria|20111104|2.0A  |null     |9.2      |null    |5            |Icp instalado   |Pa       |NO  |5.75  |null    |Empresa distribuidora          |null                           |5.75      |0.0       |0.0       |0.0       |0.0       |0.0       |20140701             |20140701               |99991231              |20171205         |NO     |null            |J             |null             |R2-515          |01              |M    |00         |NO         |0027   |\n|ES0027460000000022EM0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|39100    |SANTA CRUZ DE BEZANA       |SANTA CRUZ DE BEZANA       |Cantabria|20111104|3.0A  |null     |43.648   |null    |4            |Icp no instalado|Pc       |DH3 |43.648|43.648  |Empresa distribuidora          |Titular del punto de suministro|36.769    |36.769    |43.648    |0.0       |0.0       |0.0       |20171003             |20171003               |99991231              |20171202         |NO     |null            |J             |null             |R2-506          |02              |T    |00         |NO         |0027   |\n|ES0027460000000023EY0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|09108    |REZMONDO                   |REZMONDO                   |Burgos   |20111104|null  |null     |5.75     |null    |null         |null            |null     |null|5.75  |3.45    |null                           |null                           |null      |null      |null      |null      |null      |null      |20130612             |null                   |20160611              |20111229         |null   |null            |null          |null             |null            |null            |null |00         |NO         |0027   |\n|ES0027460000000024EF0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|34400    |HERRERA DE PISUERGA        |HERRERA DE PISUERGA        |Palencia |20111104|3.0A  |null     |125      |null    |3            |Icp no instalado|Pc       |DH3 |125.0 |null    |Empresa distribuidora          |Titular del punto de suministro|63.0      |63.0      |63.0      |0.0       |0.0       |0.0       |20171121             |null                   |99991231              |20171130         |NO     |414.98          |J             |null             |R2-243          |03              |T    |00         |NO         |0027   |\n|ES0027460000000025EP0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|39210    |ABIADA                     |HERMANDAD DE CAMPOO DE SUSO|Cantabria|20111104|2.0A  |null     |9.2      |null    |5            |Icp instalado   |Pa       |NO  |5.75  |null    |Empresa distribuidora          |Empresa distribuidora          |5.75      |0.0       |0.0       |0.0       |0.0       |0.0       |20140306             |null                   |99991231              |20171206         |NO     |30.89           |F             |null             |R2-243          |01              |M    |00         |NO         |0027   |\n|ES0027460000000026ED0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|39210    |ABIADA                     |HERMANDAD DE CAMPOO DE SUSO|Cantabria|20111104|null  |null     |5.75     |null    |null         |null            |null     |null|0.0   |null    |null                           |null                           |null      |null      |null      |null      |null      |null      |20140306             |null                   |20170305              |20111202         |null   |null            |null          |null             |null            |null            |null |00         |NO         |0027   |\n|ES0027460000000027EX0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|33600    |MIERES (MIERES (PARROQUIA))|MIERES                     |Asturias |20111223|null  |null     |11.5     |null    |null         |null            |null     |null|5.75  |null    |null                           |null                           |null      |null      |null      |null      |null      |null      |20120302             |null                   |20150301              |null             |null   |null            |null          |null             |null            |null            |null |00         |NO         |0027   |\n|ES0027460000000031EZ0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|33700    |VILLAR (LUARCA(PARROQUIA)) |VALDES                     |Asturias |20111104|2.0DHA|230      |9.2      |null    |5            |Icp instalado   |Pb       |SI  |4.6   |4.6     |Empresa distribuidora          |Empresa distribuidora          |4.6       |0.0       |0.0       |0.0       |0.0       |0.0       |20171228             |null                   |99991231              |20171117         |NO     |null            |F             |N                |R2-243          |03              |M    |00         |NO         |0027   |\n|ES0027460000000034EV0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|39012    |MONTE                      |SANTANDER                  |Cantabria|20111104|2.0A  |null     |6.9      |null    |5            |Icp instalado   |Pa       |NO  |5.75  |6.9     |Empresa distribuidora          |Empresa distribuidora          |6.9       |0.0       |0.0       |0.0       |0.0       |0.0       |20141128             |null                   |20141127              |20171203         |NO     |6.18            |F             |null             |R2-243          |02              |M    |00         |NO         |0027   |\n|ES0027460000000035EH0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|33617    |PEÑA, LA (LA PEÑA)         |MIERES                     |Asturias |20111107|2.0DHA|null     |5.75     |null    |5            |Icp instalado   |Pa       |SI  |0.0   |null    |Empresa distribuidora          |Empresa distribuidora          |5.75      |0.0       |0.0       |0.0       |0.0       |0.0       |20150318             |null                   |20150317              |20171209         |NO     |null            |F             |null             |R2-243          |01              |M    |00         |NO         |0027   |\n|ES0027460000000036EL0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|33700    |ALMUÑA (LUARCA(PARROQUIA)) |VALDES                     |Asturias |null    |null  |null     |null     |null    |null         |null            |null     |null|5.75  |null    |null                           |null                           |null      |null      |null      |null      |null      |null      |null                 |null                   |99991231              |null             |NO     |null            |null          |null             |null            |null            |null |00         |null       |0027   |\n|ES0027460000000037EC0F|VIESGO DISTRIBUCION ELECTRICA, S.L.|33770    |VEGADEO (VEGADEO)          |VEGADEO                    |Asturias |null    |null  |null     |null     |null    |null         |null            |null     |null|9.2   |null    |null                           |null                           |null      |null      |null      |null      |null      |null      |null                 |null                   |99991231              |null             |NO     |null            |null          |null             |null            |null            |null |00         |null       |0027   |\n+----------------------+-----------------------------------+---------+---------------------------+---------------------------+---------+--------+------+---------+---------+--------+-------------+----------------+---------+----+------+--------+-------------------------------+-------------------------------+----------+----------+----------+----------+----------+----------+---------------------+-----------------------+----------------------+-----------------+-------+----------------+--------------+-----------------+----------------+----------------+-----+-----------+-----------+-------+\nonly showing top 20 rows"}]},"apps":[],"jobName":"paragraph_1684613440624_-1899241361","id":"20230520-221040_1600717362","dateCreated":"2023-05-20T22:10:40+0200","dateStarted":"2023-05-23T09:53:19+0200","dateFinished":"2023-05-23T09:53:21+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2897"},{"text":"%md\n###Extract and Transformation of **consumption** for Viesgo and Begasa","user":"anonymous","dateUpdated":"2023-05-23T10:25:13+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Extract and Transformation of <strong>consumption</strong> for Viesgo and Begasa</h3>\n"}]},"apps":[],"jobName":"paragraph_1684691452638_880424356","id":"20230521-195052_889258428","dateCreated":"2023-05-21T19:50:52+0200","dateStarted":"2023-05-23T10:25:13+0200","dateFinished":"2023-05-23T10:25:13+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2898"},{"text":"%spark\nval viesgoConsumptionPathRaw = \"/user/training/adriana/raw/VIESGO/VIESGO/Punto_Suministro_Periodos_20180105.csv\"\nval begasaConsumptionPathRaw = \"/user/training/adriana/raw/VIESGO/BEGASA/Punto_Suministro_Periodos_20180106.csv\"","user":"anonymous","dateUpdated":"2023-05-23T09:53:33+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"viesgoConsumptionPathRaw: String = /user/training/adriana/raw/VIESGO/VIESGO/Punto_Suministro_Periodos_20180105.csv\nbegasaConsumptionPathRaw: String = /user/training/adriana/raw/VIESGO/BEGASA/Punto_Suministro_Periodos_20180106.csv"}]},"apps":[],"jobName":"paragraph_1684691681218_2052305542","id":"20230521-195441_1529440734","dateCreated":"2023-05-21T19:54:41+0200","dateStarted":"2023-05-23T09:53:33+0200","dateFinished":"2023-05-23T09:53:34+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2899"},{"text":"%spark\nval viesgoConsInitialDF = spark.read.option(\"header\", \"true\").option(\"sep\", \";\").option(\"encoding\", \"iso-8859-1\").csv(viesgoConsumptionPathRaw)\nval begasaConsInitialDF = spark.read.option(\"header\", \"true\").option(\"sep\", \";\").option(\"encoding\", \"iso-8859-1\").csv(begasaConsumptionPathRaw)","user":"anonymous","dateUpdated":"2023-05-23T09:53:36+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"viesgoConsInitialDF: org.apache.spark.sql.DataFrame = [CUPS: string, ANIO_FACTURACION: string ... 8 more fields]\nbegasaConsInitialDF: org.apache.spark.sql.DataFrame = [CUPS: string, ANIO_FACTURACION: string ... 8 more fields]"}]},"apps":[],"jobName":"paragraph_1684691857410_1586099570","id":"20230521-195737_1225876592","dateCreated":"2023-05-21T19:57:37+0200","dateStarted":"2023-05-23T09:53:36+0200","dateFinished":"2023-05-23T09:53:38+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2900"},{"text":"%spark\n//check if viesgoConsInitialDF and begasaConsInitialDF have the same structure\nval columnsConsViesgo = viesgoConsInitialDF.columns.toSet\nval columnsConsBegasa = begasaConsInitialDF.columns.toSet\n\nif (columnsConsViesgo != columnsConsBegasa) {\n  println(\"Column structures do not match\")\n}","user":"anonymous","dateUpdated":"2023-05-23T09:53:41+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"columnsConsViesgo: scala.collection.immutable.Set[String] = Set(POT_FACTURADA, ANIO_FACTURACION, PERIODO, FECHA_INICIAL, REACTIVA1, FECHA_FINAL, CUPS, REACTIVA4, TARIFA, ENERGIA_ACTIVA)\ncolumnsConsBegasa: scala.collection.immutable.Set[String] = Set(POT_FACTURADA, ANIO_FACTURACION, PERIODO, FECHA_INICIAL, REACTIVA1, FECHA_FINAL, CUPS, REACTIVA4, TARIFA, ENERGIA_ACTIVA)"}]},"apps":[],"jobName":"paragraph_1684691894737_-2033344660","id":"20230521-195814_1108293501","dateCreated":"2023-05-21T19:58:14+0200","dateStarted":"2023-05-23T09:53:41+0200","dateFinished":"2023-05-23T09:53:42+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2901"},{"text":"\n%spark\nval schemaConsumption = StructType(Array(  \n\t  StructField(\"cups\", StringType,  nullable = true), \n\t  StructField(\"anio_facturacion\", IntegerType,  nullable = true), \n\t  StructField(\"finicio\", StringType, nullable = true), \n\t  StructField(\"ffin\", StringType, nullable = true), \n\t  StructField(\"periodo\", IntegerType, nullable = true), \n\t  StructField(\"consumoactivap1\", FloatType,  nullable = true), \n\t  StructField(\"consumoreactivap1\", FloatType, nullable = true), \n\t  StructField(\"consumoreactivap4\", FloatType,  nullable = true), \n\t  StructField(\"pot_facturada\", IntegerType,  nullable = true), \n\t  StructField(\"tarifa\", StringType,  nullable = true)\n\t )\n)","user":"anonymous","dateUpdated":"2023-05-23T09:53:45+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"schemaConsumption: org.apache.spark.sql.types.StructType = StructType(StructField(cups,StringType,true), StructField(anio_facturacion,IntegerType,true), StructField(finicio,StringType,true), StructField(ffin,StringType,true), StructField(periodo,IntegerType,true), StructField(consumoactivap1,FloatType,true), StructField(consumoreactivap1,FloatType,true), StructField(consumoreactivap4,FloatType,true), StructField(pot_facturada,IntegerType,true), StructField(tarifa,StringType,true))"}]},"apps":[],"jobName":"paragraph_1684620208649_-2062207721","id":"20230521-000328_1725550734","dateCreated":"2023-05-21T00:03:28+0200","dateStarted":"2023-05-23T09:53:45+0200","dateFinished":"2023-05-23T09:53:46+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2902"},{"text":"%spark\nval viesgoConsumptionDF = spark.read.schema(schemaConsumption).option(\"header\", \"true\").option(\"sep\", \";\").csv(viesgoConsumptionPathRaw)\nval BegasaConsumptionDF = spark.read.schema(schemaConsumption).option(\"header\", \"true\").option(\"sep\", \";\").csv(begasaConsumptionPathRaw)\n","user":"anonymous","dateUpdated":"2023-05-23T09:53:48+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"viesgoConsumptionDF: org.apache.spark.sql.DataFrame = [cups: string, anio_facturacion: int ... 8 more fields]\nBegasaConsumptionDF: org.apache.spark.sql.DataFrame = [cups: string, anio_facturacion: int ... 8 more fields]"}]},"apps":[],"jobName":"paragraph_1684669093837_-789585512","id":"20230521-133813_694935629","dateCreated":"2023-05-21T13:38:13+0200","dateStarted":"2023-05-23T09:53:49+0200","dateFinished":"2023-05-23T09:53:50+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2903"},{"text":"%spark\n//Create a data frame from the join of the data of Viesgo and Begasa for consumptions \nval viesgoBegasaConsumptionDF = viesgoConsumptionDF.union(BegasaConsumptionDF)\n","user":"anonymous","dateUpdated":"2023-05-23T09:53:53+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"viesgoBegasaConsumptionDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [cups: string, anio_facturacion: int ... 8 more fields]"}]},"apps":[],"jobName":"paragraph_1684692408005_-1527083639","id":"20230521-200648_1076771634","dateCreated":"2023-05-21T20:06:48+0200","dateStarted":"2023-05-23T09:53:53+0200","dateFinished":"2023-05-23T09:53:54+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2904"},{"text":"%spark\nviesgoBegasaConsumptionDF.printSchema()","user":"anonymous","dateUpdated":"2023-05-23T09:53:57+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- cups: string (nullable = true)\n |-- anio_facturacion: integer (nullable = true)\n |-- finicio: string (nullable = true)\n |-- ffin: string (nullable = true)\n |-- periodo: integer (nullable = true)\n |-- consumoactivap1: float (nullable = true)\n |-- consumoreactivap1: float (nullable = true)\n |-- consumoreactivap4: float (nullable = true)\n |-- pot_facturada: integer (nullable = true)\n |-- tarifa: string (nullable = true)"}]},"apps":[],"jobName":"paragraph_1684825519808_555529715","id":"20230523-090519_59987619","dateCreated":"2023-05-23T09:05:19+0200","dateStarted":"2023-05-23T09:53:57+0200","dateFinished":"2023-05-23T09:53:58+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2905"},{"text":"%spark\nviesgoBegasaConsumptionDF.count()\nviesgoBegasaConsumptionDF.show(false)\n","user":"anonymous","dateUpdated":"2023-05-23T09:54:06+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res116: Long = 570042\n+----------------------+----------------+----------+----------+-------+---------------+-----------------+-----------------+-------------+------+\n|cups                  |anio_facturacion|finicio   |ffin      |periodo|consumoactivap1|consumoreactivap1|consumoreactivap4|pot_facturada|tarifa|\n+----------------------+----------------+----------+----------+-------+---------------+-----------------+-----------------+-------------+------+\n|ES0027460000000003KD0F|2015            |07/12/2014|06/02/2015|1      |479000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2015            |07/02/2015|06/03/2015|1      |245000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2015            |07/03/2015|06/04/2015|1      |265000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2015            |07/04/2015|06/05/2015|1      |333000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2015            |07/06/2015|06/07/2015|1      |240000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2015            |07/07/2015|06/08/2015|1      |160000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2015            |07/08/2015|06/09/2015|1      |146000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2015            |07/09/2015|06/10/2015|1      |191000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2015            |07/10/2015|06/11/2015|1      |248000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2015            |07/11/2015|06/12/2015|1      |266000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2016            |07/12/2015|06/01/2016|1      |282000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2016            |07/01/2016|06/02/2016|1      |343000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2016            |07/02/2016|06/03/2016|1      |356000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2016            |07/03/2016|06/04/2016|1      |339000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2016            |07/04/2016|06/05/2016|1      |318000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2016            |07/05/2016|06/06/2016|1      |204000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2016            |07/06/2016|06/07/2016|1      |169000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2016            |07/07/2016|06/08/2016|1      |174000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2016            |07/08/2016|06/09/2016|1      |164000.0       |null             |null             |null         |001   |\n|ES0027460000000003KD0F|2016            |07/09/2016|06/10/2016|1      |155000.0       |null             |null             |null         |001   |\n+----------------------+----------------+----------+----------+-------+---------------+-----------------+-----------------+-------------+------+\nonly showing top 20 rows"}]},"apps":[],"jobName":"paragraph_1684692463199_1356041736","id":"20230521-200743_1508175985","dateCreated":"2023-05-21T20:07:43+0200","dateStarted":"2023-05-23T09:54:06+0200","dateFinished":"2023-05-23T09:54:08+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2906"},{"text":"%spark\n//check for duplicates\nviesgoBegasaConsumptionDF.count()\nviesgoBegasaConsumptionDF.dropDuplicates.count()\n","user":"anonymous","dateUpdated":"2023-05-23T09:54:10+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":93.15,"optionOpen":false}}},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res119: Long = 570042\nres120: Long = 569930"}]},"apps":[],"jobName":"paragraph_1684676751966_-1925160648","id":"20230521-154551_1210887729","dateCreated":"2023-05-21T15:45:51+0200","dateStarted":"2023-05-23T09:54:10+0200","dateFinished":"2023-05-23T09:54:14+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2907"},{"text":"%spark\n//List duplicate row\nviesgoBegasaConsumptionDF.groupBy(viesgoBegasaConsumptionDF.columns.map(col): _*).count().filter(col(\"count\") > 1).select(viesgoBegasaConsumptionDF.columns.map(col): _*).show(false)","user":"anonymous","dateUpdated":"2023-05-23T09:54:14+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------------------+----------------+----------+----------+-------+---------------+-----------------+-----------------+-------------+------+\n|cups                  |anio_facturacion|finicio   |ffin      |periodo|consumoactivap1|consumoreactivap1|consumoreactivap4|pot_facturada|tarifa|\n+----------------------+----------------+----------+----------+-------+---------------+-----------------+-----------------+-------------+------+\n|ES0033620000002866QD0F|2016            |01/07/2016|31/07/2016|1      |5000.0         |0.0              |1000.0           |0            |003   |\n|ES0033620000002866QD0F|2016            |01/03/2016|31/03/2016|6      |3000.0         |0.0              |0.0              |0            |003   |\n|ES0033620000002866QD0F|2016            |01/06/2016|30/06/2016|5      |5000.0         |0.0              |1000.0           |0            |003   |\n|ES0033620000009046DW0F|2015            |01/10/2015|31/10/2015|0      |3294000.0      |2154000.0        |424000.0         |51000        |003   |\n|ES0027460000012247RV0F|2016            |01/02/2016|29/02/2016|5      |501000.0       |3000.0           |123000.0         |11000        |003   |\n|ES0027460000013504XD0F|2015            |01/10/2015|31/10/2015|0      |1.5556E7       |7200000.0        |0.0              |56000        |003   |\n|ES0033620000002866QD0F|2016            |01/11/2016|30/11/2016|0      |39000.0        |0.0              |5000.0           |0            |003   |\n|ES0033620000009046DW0F|2015            |01/10/2015|31/10/2015|1      |601000.0       |413000.0         |40000.0          |39000        |003   |\n|ES0027460000013504XD0F|2015            |01/10/2015|31/10/2015|3      |2323000.0      |1475000.0        |0.0              |29000        |003   |\n|ES0027460000012247RV0F|2017            |01/10/2017|31/10/2017|5      |182000.0       |0.0              |259000.0         |4000         |003   |\n|ES0033620000002866QD0F|2016            |01/05/2016|31/05/2016|1      |5000.0         |0.0              |1000.0           |0            |003   |\n|ES0027460000013504XD0F|2015            |01/09/2015|30/09/2015|1      |2081000.0      |983000.0         |0.0              |41000        |003   |\n|ES0027460000012247RV0F|2016            |01/02/2016|29/02/2016|6      |332000.0       |0.0              |102000.0         |16000        |003   |\n|ES0027460000013504XD0F|2015            |01/08/2015|31/08/2015|3      |3232000.0      |1865000.0        |0.0              |35000        |003   |\n|ES0033620000002866QD0F|2016            |01/04/2016|30/04/2016|5      |6000.0         |0.0              |1000.0           |0            |003   |\n|ES0027460000007783ZS0F|2016            |01/07/2016|31/07/2016|5      |1874000.0      |1227000.0        |62000.0          |43000        |003   |\n|ES0027460000013504XD0F|2015            |01/08/2015|31/08/2015|4      |1195000.0      |497000.0         |0.0              |45000        |003   |\n|ES0027460000013504XD0F|2015            |01/08/2015|31/08/2015|0      |1.836E7        |8695000.0        |0.0              |52000        |003   |\n|ES0033620000002866QD0F|2016            |01/05/2016|31/05/2016|5      |5000.0         |0.0              |0.0              |0            |003   |\n|ES0027460000012247RV0F|2017            |01/10/2017|31/10/2017|4      |68000.0        |0.0              |83000.0          |3000         |003   |\n+----------------------+----------------+----------+----------+-------+---------------+-----------------+-----------------+-------------+------+\nonly showing top 20 rows"}]},"apps":[],"jobName":"paragraph_1684680650852_-67471434","id":"20230521-165050_215007959","dateCreated":"2023-05-21T16:50:50+0200","dateStarted":"2023-05-23T09:54:14+0200","dateFinished":"2023-05-23T09:54:17+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2908"},{"text":"%spark\n//Remove the duplicates\nval viesgoBegasaConsumptionDFclean = viesgoBegasaConsumptionDF.dropDuplicates()","user":"anonymous","dateUpdated":"2023-05-23T09:54:21+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"viesgoBegasaConsumptionDFclean: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [cups: string, anio_facturacion: int ... 8 more fields]"}]},"apps":[],"jobName":"paragraph_1684680030747_1918591844","id":"20230521-164030_1392960779","dateCreated":"2023-05-21T16:40:30+0200","dateStarted":"2023-05-23T09:54:21+0200","dateFinished":"2023-05-23T09:54:22+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2909"},{"text":"%spark\n//viesgoBegasaConsumptionDFFinal does:\n//Converts the string dd/MM/yyyy to timestamp type using the to_timestamp function ","user":"anonymous","dateUpdated":"2023-05-23T09:54:24+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1684825958560_390111633","id":"20230523-091238_816591523","dateCreated":"2023-05-23T09:12:38+0200","dateStarted":"2023-05-23T09:54:24+0200","dateFinished":"2023-05-23T09:54:25+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2910"},{"text":"%spark\nval viesgoBegasaConsumptionDFFinal = (viesgoBegasaConsumptionDFclean.withColumn(\"finicio\", to_timestamp($\"finicio\", \"dd/MM/yyyy\") as \"finicio\")\n                                      .withColumn(\"ffin\", to_timestamp($\"ffin\", \"dd/MM/yyyy\") as \"ffin\"))\nviesgoBegasaConsumptionDFFinal.show(false)","user":"anonymous","dateUpdated":"2023-05-23T09:54:28+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"viesgoBegasaConsumptionDFFinal: org.apache.spark.sql.DataFrame = [cups: string, anio_facturacion: int ... 8 more fields]\n+----------------------+----------------+-------------------+-------------------+-------+---------------+-----------------+-----------------+-------------+------+\n|cups                  |anio_facturacion|finicio            |ffin               |periodo|consumoactivap1|consumoreactivap1|consumoreactivap4|pot_facturada|tarifa|\n+----------------------+----------------+-------------------+-------------------+-------+---------------+-----------------+-----------------+-------------+------+\n|ES0027460000000048TP0F|2017            |2017-08-06 00:00:00|2017-09-05 00:00:00|1      |86000.0        |null             |null             |null         |001   |\n|ES0027460000000051TB0F|2016            |2016-05-11 00:00:00|2016-06-10 00:00:00|1      |373000.0       |null             |null             |null         |001   |\n|ES0027460000000051TB0F|2017            |2017-10-11 00:00:00|2017-11-10 00:00:00|1      |448000.0       |null             |null             |null         |001   |\n|ES0027460000000111AW0F|2015            |2015-09-07 00:00:00|2015-10-06 00:00:00|1      |63000.0        |null             |null             |null         |001   |\n|ES0027460000000125AQ0F|2015            |2015-04-07 00:00:00|2015-05-06 00:00:00|2      |30000.0        |0.0              |null             |null         |006   |\n|ES0027460000000125AQ0F|2016            |2016-01-07 00:00:00|2016-02-06 00:00:00|2      |34000.0        |1000.0           |null             |null         |006   |\n|ES0027460000000135GA0F|2015            |2015-02-07 00:00:00|2015-03-06 00:00:00|1      |151000.0       |null             |null             |null         |001   |\n|ES0027460000000138GY0F|2017            |2017-09-07 00:00:00|2017-10-06 00:00:00|2      |64000.0        |null             |null             |null         |004   |\n|ES0027460000000142GX0F|2016            |2016-05-07 00:00:00|2016-06-07 00:00:00|1      |0.0            |null             |null             |null         |001   |\n|ES0027460000000153GK0F|2016            |2016-09-02 00:00:00|2016-10-01 00:00:00|1      |10000.0        |null             |null             |null         |004   |\n|ES0027460000000164MD0F|2015            |2015-05-03 00:00:00|2015-06-02 00:00:00|1      |8000.0         |null             |null             |null         |001   |\n|ES0027460000000049TD0F|2016            |2016-09-01 00:00:00|2016-09-30 00:00:00|0      |5.04358016E8   |3.71511008E8     |0.0              |1020000      |015   |\n|ES0027460000000174ML0F|2016            |2016-05-03 00:00:00|2016-06-02 00:00:00|1      |132000.0       |0.0              |null             |null         |005   |\n|ES0027460000000188YX0F|2016            |2016-06-01 00:00:00|2016-06-30 00:00:00|1      |0.0            |null             |null             |null         |001   |\n|ES0027460000000198YC0F|2016            |2016-04-03 00:00:00|2016-05-02 00:00:00|1      |115000.0       |null             |null             |null         |001   |\n|ES0027460000000221FC0F|2015            |2015-03-06 00:00:00|2015-04-05 00:00:00|3      |272000.0       |36000.0          |null             |1000         |003   |\n|ES0027460000000232PP0F|2016            |2016-11-06 00:00:00|2016-12-05 00:00:00|1      |0.0            |null             |null             |null         |001   |\n|ES0027460000000239PS0F|2017            |2017-05-06 00:00:00|2017-06-05 00:00:00|2      |16000.0        |null             |null             |null         |004   |\n|ES0027460000000243PL0F|2015            |2015-04-06 00:00:00|2015-04-07 00:00:00|1      |4000.0         |null             |null             |null         |004   |\n|ES0027460000000248DR0F|2017            |2016-12-06 00:00:00|2017-01-05 00:00:00|1      |108000.0       |null             |null             |null         |001   |\n+----------------------+----------------+-------------------+-------------------+-------+---------------+-----------------+-----------------+-------------+------+\nonly showing top 20 rows"}]},"apps":[],"jobName":"paragraph_1684669360086_-1231852224","id":"20230521-134240_1153180243","dateCreated":"2023-05-21T13:42:40+0200","dateStarted":"2023-05-23T09:54:28+0200","dateFinished":"2023-05-23T09:54:31+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2911"},{"text":"%spark\nviesgoBegasaConsumptionDFFinal.printSchema()","user":"anonymous","dateUpdated":"2023-05-23T09:54:35+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- cups: string (nullable = true)\n |-- anio_facturacion: integer (nullable = true)\n |-- finicio: timestamp (nullable = true)\n |-- ffin: timestamp (nullable = true)\n |-- periodo: integer (nullable = true)\n |-- consumoactivap1: float (nullable = true)\n |-- consumoreactivap1: float (nullable = true)\n |-- consumoreactivap4: float (nullable = true)\n |-- pot_facturada: integer (nullable = true)\n |-- tarifa: string (nullable = true)"}]},"apps":[],"jobName":"paragraph_1684669987195_1863813136","id":"20230521-135307_609932848","dateCreated":"2023-05-21T13:53:07+0200","dateStarted":"2023-05-23T09:54:36+0200","dateFinished":"2023-05-23T09:54:37+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2912"},{"text":"%md\n###Data dump in parquet format in HDFS\n","user":"anonymous","dateUpdated":"2023-05-23T10:18:59+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Data dump in parquet format in HDFS</h3>\n"}]},"apps":[],"jobName":"paragraph_1684693053071_1030938380","id":"20230521-201733_525051292","dateCreated":"2023-05-21T20:17:33+0200","dateStarted":"2023-05-23T10:18:59+0200","dateFinished":"2023-05-23T10:19:00+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2913"},{"text":"%spark\nval viesgoBegasaPsPathRefined = \"/user/training/adriana/refined/Viesgo_Begasa_ps/\"\nval viesgoBegasaConsumptionPathRefined = \"/user/training/adriana/refined/Viesgo_Begasa_consumption/\"\n","user":"anonymous","dateUpdated":"2023-05-23T09:54:45+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"viesgoBegasaPsPathRefined: String = /user/training/adriana/refined/Viesgo_Begasa_ps/\nviesgoBegasaConsumptionPathRefined: String = /user/training/adriana/refined/Viesgo_Begasa_consumption/"}]},"apps":[],"jobName":"paragraph_1684602535660_1638352802","id":"20230520-190855_748480649","dateCreated":"2023-05-20T19:08:55+0200","dateStarted":"2023-05-23T09:54:45+0200","dateFinished":"2023-05-23T09:54:46+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2914"},{"text":"%spark\nviesgoBegasaPsDFClean.write.format(\"parquet\").mode(\"overwrite\").save(viesgoBegasaPsPathRefined)","user":"anonymous","dateUpdated":"2023-05-23T09:48:23+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1684616931662_-1152134629","id":"20230520-230851_1608366613","dateCreated":"2023-05-20T23:08:51+0200","dateStarted":"2023-05-23T09:48:23+0200","dateFinished":"2023-05-23T09:48:28+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2915"},{"text":"%spark\nviesgoBegasaConsumptionDFFinal.write.format(\"parquet\").mode(\"overwrite\").save(viesgoBegasaConsumptionPathRefined)","user":"anonymous","dateUpdated":"2023-05-23T09:49:01+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1684669708820_430455436","id":"20230521-134828_299885353","dateCreated":"2023-05-21T13:48:28+0200","dateStarted":"2023-05-23T09:49:01+0200","dateFinished":"2023-05-23T09:49:33+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2916"},{"text":"%sh\n","user":"anonymous","dateUpdated":"2023-05-20T23:19:09+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1684617549940_2127101765","id":"20230520-231909_2033061202","dateCreated":"2023-05-20T23:19:09+0200","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:2917"}],"name":"Caso_practico/silver/ETL_viesgo_begasa","id":"2J2MPBY8G","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"sh:shared_process":[],"livy:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}