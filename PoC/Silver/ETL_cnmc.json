{"paragraphs":[{"text":"%md\n#### This notebook reads CSV files for supply poins (ps) and consumptions (cons) of CNMC and extracts information into data frames\n","user":"anonymous","dateUpdated":"2023-05-23T13:08:01+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":false,"tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>This notebook reads CSV files for supply poins (ps) and consumptions (cons) of CNMC and extracts information into data frames</h4>\n"}]},"apps":[],"jobName":"paragraph_1684790733789_1525278426","id":"20230522-232533_74040657","dateCreated":"2023-05-22T23:25:33+0200","dateStarted":"2023-05-23T11:20:49+0200","dateFinished":"2023-05-23T11:20:49+0200","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:642"},{"text":"%spark\nimport org.apache.spark.sql.{SparkSession, DataFrame}\nimport org.apache.spark.sql.functions.{udf, col}\nimport org.apache.spark.sql.types._\nimport java.sql.Timestamp\nimport java.text.SimpleDateFormat","user":"anonymous","dateUpdated":"2023-05-23T10:22:15+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.{SparkSession, DataFrame}\nimport org.apache.spark.sql.functions.{udf, col}\nimport org.apache.spark.sql.types._\nimport java.sql.Timestamp\nimport java.text.SimpleDateFormat"}]},"apps":[],"jobName":"paragraph_1684336748370_343693052","id":"20230517-171908_773654754","dateCreated":"2023-05-17T17:19:08+0200","dateStarted":"2023-05-23T10:22:16+0200","dateFinished":"2023-05-23T10:22:18+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:643"},{"text":"%md\n###Extract and Transformation of **consumptions** for CNMC","user":"anonymous","dateUpdated":"2023-05-23T11:50:27+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Extract and Transformation of <strong>consumptions</strong> for CNMC</h3>\n"}]},"apps":[],"jobName":"paragraph_1684336858318_1637961477","id":"20230517-172058_714634643","dateCreated":"2023-05-17T17:20:58+0200","dateStarted":"2023-05-23T11:50:27+0200","dateFinished":"2023-05-23T11:50:27+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:644"},{"text":"%spark\nval cnmcConsumptionPathRaw = \"/user/training/adriana/raw/CNMC/201712_SIPS2_CONSUMOS_ELECTRICIDAD_nacional.csv\"\n","user":"anonymous","dateUpdated":"2023-05-23T10:22:26+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"cnmcConsumptionPathRaw: String = /user/training/adriana/raw/CNMC/201712_SIPS2_CONSUMOS_ELECTRICIDAD_nacional.csv"}]},"apps":[],"jobName":"paragraph_1684336847364_-102475920","id":"20230517-172047_1116658171","dateCreated":"2023-05-17T17:20:47+0200","dateStarted":"2023-05-23T10:22:27+0200","dateFinished":"2023-05-23T10:22:28+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:645"},{"text":"%spark\nval schemaConsumption = StructType(Array(\n    StructField(\"cups\", StringType, nullable = false),\n    StructField(\"finicio\", TimestampType, nullable = true),\n    StructField(\"ffin\", TimestampType, nullable = true),\n    StructField(\"tarifa\", StringType, nullable = true),\n    StructField(\"consumoactivap1\", FloatType, nullable = true),\n    StructField(\"consumoactivap2\", FloatType, nullable = true),\n    StructField(\"consumoactivap3\", FloatType, nullable = true),\n    StructField(\"consumoactivap4\", FloatType, nullable = true),\n    StructField(\"consumoactivap5\", FloatType, nullable = true),\n    StructField(\"consumoactivap6\", FloatType, nullable = true),\n    StructField(\"consumoreactivap1\", FloatType, nullable = true),\n    StructField(\"consumoreactivap2\", FloatType, nullable = true),\n    StructField(\"consumoreactivap3\", FloatType, nullable = true),\n    StructField(\"consumoreactivap4\", FloatType, nullable = true),\n    StructField(\"consumoreactivap5\", FloatType, nullable = true),\n    StructField(\"consumoreactivap6\", FloatType, nullable = true),\n    StructField(\"potmaxp1\", FloatType, nullable = true),\n    StructField(\"potmaxp2\", FloatType, nullable = true),\n    StructField(\"potmaxp3\", FloatType, nullable = true),\n    StructField(\"potmaxp4\", FloatType, nullable = true),\n    StructField(\"potmaxp5\", FloatType, nullable = true),\n    StructField(\"potmaxp6\", FloatType, nullable = true),\n    StructField(\"codigoDHEquipoDeMedida\", IntegerType, nullable = true),\n    StructField(\"codigoTipoLectura\", StringType, nullable = true)\n  )\n)","user":"anonymous","dateUpdated":"2023-05-23T10:22:33+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"schemaConsumption: org.apache.spark.sql.types.StructType = StructType(StructField(cups,StringType,false), StructField(finicio,TimestampType,true), StructField(ffin,TimestampType,true), StructField(tarifa,StringType,true), StructField(consumoactivap1,FloatType,true), StructField(consumoactivap2,FloatType,true), StructField(consumoactivap3,FloatType,true), StructField(consumoactivap4,FloatType,true), StructField(consumoactivap5,FloatType,true), StructField(consumoactivap6,FloatType,true), StructField(consumoreactivap1,FloatType,true), StructField(consumoreactivap2,FloatType,true), StructField(consumoreactivap3,FloatType,true), StructField(consumoreactivap4,FloatType,true), StructField(consumoreactivap5,FloatType,true), StructField(consumoreactivap6,FloatType,true), StructField(potmaxp1,Fl..."}]},"apps":[],"jobName":"paragraph_1684341308748_2123446850","id":"20230517-183508_860605900","dateCreated":"2023-05-17T18:35:08+0200","dateStarted":"2023-05-23T10:22:33+0200","dateFinished":"2023-05-23T10:22:34+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:646"},{"text":"%spark\nval cnmcConsumptionDF = spark.read.schema(schemaConsumption).option(\"header\", \"true\").csv(cnmcConsumptionPathRaw)\n","user":"anonymous","dateUpdated":"2023-05-23T10:22:37+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"cnmcConsumptionDF: org.apache.spark.sql.DataFrame = [cups: string, finicio: timestamp ... 22 more fields]"}]},"apps":[],"jobName":"paragraph_1684341425942_1333164221","id":"20230517-183705_2114527419","dateCreated":"2023-05-17T18:37:05+0200","dateStarted":"2023-05-23T10:22:37+0200","dateFinished":"2023-05-23T10:22:38+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:647"},{"text":"%spark\ncnmcConsumptionDF.printSchema()","user":"anonymous","dateUpdated":"2023-05-23T10:22:42+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- cups: string (nullable = true)\n |-- finicio: timestamp (nullable = true)\n |-- ffin: timestamp (nullable = true)\n |-- tarifa: string (nullable = true)\n |-- consumoactivap1: float (nullable = true)\n |-- consumoactivap2: float (nullable = true)\n |-- consumoactivap3: float (nullable = true)\n |-- consumoactivap4: float (nullable = true)\n |-- consumoactivap5: float (nullable = true)\n |-- consumoactivap6: float (nullable = true)\n |-- consumoreactivap1: float (nullable = true)\n |-- consumoreactivap2: float (nullable = true)\n |-- consumoreactivap3: float (nullable = true)\n |-- consumoreactivap4: float (nullable = true)\n |-- consumoreactivap5: float (nullable = true)\n |-- consumoreactivap6: float (nullable = true)\n |-- potmaxp1: float (nullable = true)\n |-- potmaxp2: float (nullable = true)\n |-- potmaxp3: float (nullable = true)\n |-- potmaxp4: float (nullable = true)\n |-- potmaxp5: float (nullable = true)\n |-- potmaxp6: float (nullable = true)\n |-- codigoDHEquipoDeMedida: integer (nullable = true)\n |-- codigoTipoLectura: string (nullable = true)"}]},"apps":[],"jobName":"paragraph_1684337933319_869206248","id":"20230517-173853_1963633221","dateCreated":"2023-05-17T17:38:53+0200","dateStarted":"2023-05-23T10:22:42+0200","dateFinished":"2023-05-23T10:22:43+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:648"},{"text":"%spark\n//check for duplicates\ncnmcConsumptionDF.count()\ncnmcConsumptionDF.dropDuplicates().count()\n\n","user":"anonymous","dateUpdated":"2023-05-23T10:22:45+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res138: Long = 1538018\nres139: Long = 1538018"}]},"apps":[],"jobName":"paragraph_1684337289975_-1591275610","id":"20230517-172809_179100023","dateCreated":"2023-05-17T17:28:09+0200","dateStarted":"2023-05-23T10:22:45+0200","dateFinished":"2023-05-23T10:23:04+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:649"},{"text":"%spark\n//cnmcConsumptionDFclean does:\n//Converts the null elements to zero for the 'consumoactivap1-6' columns","user":"anonymous","dateUpdated":"2023-05-23T10:24:02+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1684829450975_-1209621465","id":"20230523-101050_846100190","dateCreated":"2023-05-23T10:10:50+0200","dateStarted":"2023-05-23T10:24:02+0200","dateFinished":"2023-05-23T10:24:03+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:650"},{"text":"%spark\nval cnmcConsumptionDFclean = (cnmcConsumptionDF.withColumn(\"consumoactivap1\", when(col(\"consumoactivap1\").isNull, 0).otherwise(col(\"consumoactivap1\")))\n                                               .withColumn(\"consumoactivap2\", when(col(\"consumoactivap2\").isNull, 0).otherwise(col(\"consumoactivap2\")))\n                                               .withColumn(\"consumoactivap3\", when(col(\"consumoactivap3\").isNull, 0).otherwise(col(\"consumoactivap3\")))\n                                               .withColumn(\"consumoactivap4\", when(col(\"consumoactivap4\").isNull, 0).otherwise(col(\"consumoactivap4\")))\n                                               .withColumn(\"consumoactivap5\", when(col(\"consumoactivap5\").isNull, 0).otherwise(col(\"consumoactivap5\")))\n                                               .withColumn(\"consumoactivap6\", when(col(\"consumoactivap6\").isNull, 0).otherwise(col(\"consumoactivap6\"))))\ncnmcConsumptionDFclean.show(false)","user":"anonymous","dateUpdated":"2023-05-23T10:24:05+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"cnmcConsumptionDFclean: org.apache.spark.sql.DataFrame = [cups: string, finicio: timestamp ... 22 more fields]\n+--------------------+-------------------+-------------------+------+---------------+---------------+---------------+---------------+---------------+---------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+--------+--------+--------+--------+--------+--------+----------------------+-----------------+\n|cups                |finicio            |ffin               |tarifa|consumoactivap1|consumoactivap2|consumoactivap3|consumoactivap4|consumoactivap5|consumoactivap6|consumoreactivap1|consumoreactivap2|consumoreactivap3|consumoreactivap4|consumoreactivap5|consumoreactivap6|potmaxp1|potmaxp2|potmaxp3|potmaxp4|potmaxp5|potmaxp6|codigoDHEquipoDeMedida|codigoTipoLectura|\n+--------------------+-------------------+-------------------+------+---------------+---------------+---------------+---------------+---------------+---------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+--------+--------+--------+--------+--------+--------+----------------------+-----------------+\n|ES0480100000003616HB|2017-08-31 00:00:00|2017-10-31 00:00:00|001   |0.0            |83000.0        |0.0            |0.0            |0.0            |0.0            |0.0              |0.0              |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480100000003616HB|2017-06-30 00:00:00|2017-08-31 00:00:00|001   |0.0            |190000.0       |0.0            |0.0            |0.0            |0.0            |0.0              |0.0              |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480100000003616HB|2017-04-30 00:00:00|2017-06-30 00:00:00|001   |0.0            |588000.0       |0.0            |0.0            |0.0            |0.0            |0.0              |0.0              |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480100000003616HB|2017-02-28 00:00:00|2017-04-30 00:00:00|001   |0.0            |0.0            |0.0            |0.0            |0.0            |0.0            |0.0              |0.0              |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480100000003616HB|2016-12-31 00:00:00|2017-02-28 00:00:00|001   |0.0            |18000.0        |0.0            |0.0            |0.0            |0.0            |0.0              |0.0              |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480100000003616HB|2016-10-31 00:00:00|2016-12-31 00:00:00|001   |0.0            |47000.0        |0.0            |0.0            |0.0            |0.0            |0.0              |0.0              |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480100000003616HB|2016-08-31 00:00:00|2016-10-31 00:00:00|001   |0.0            |79000.0        |0.0            |0.0            |0.0            |0.0            |0.0              |0.0              |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480100000003616HB|2016-06-30 00:00:00|2016-08-31 00:00:00|001   |0.0            |518000.0       |0.0            |0.0            |0.0            |0.0            |0.0              |0.0              |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480100000003616HB|2016-04-30 00:00:00|2016-06-30 00:00:00|001   |0.0            |0.0            |0.0            |0.0            |0.0            |0.0            |0.0              |0.0              |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480100000003616HB|2016-02-29 00:00:00|2016-04-30 00:00:00|001   |0.0            |0.0            |0.0            |0.0            |0.0            |0.0            |0.0              |0.0              |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480100000003616HB|2015-12-31 00:00:00|2016-02-29 00:00:00|001   |0.0            |106000.0       |0.0            |0.0            |0.0            |0.0            |0.0              |0.0              |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480100000003616HB|2015-10-31 00:00:00|2015-12-31 00:00:00|001   |0.0            |115000.0       |0.0            |0.0            |0.0            |0.0            |0.0              |0.0              |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480000054001699VY|2017-08-31 00:00:00|2017-10-31 00:00:00|001   |0.0            |54000.0        |0.0            |0.0            |0.0            |0.0            |0.0              |29000.0          |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480000054001699VY|2017-07-01 00:00:00|2017-08-31 00:00:00|001   |0.0            |160000.0       |0.0            |0.0            |0.0            |0.0            |0.0              |34000.0          |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480000054001699VY|2017-04-30 00:00:00|2017-06-30 00:00:00|001   |0.0            |37000.0        |0.0            |0.0            |0.0            |0.0            |0.0              |27000.0          |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480000054001699VY|2017-02-28 00:00:00|2017-04-30 00:00:00|001   |0.0            |84000.0        |0.0            |0.0            |0.0            |0.0            |0.0              |29000.0          |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480000054001699VY|2016-12-31 00:00:00|2017-02-28 00:00:00|001   |0.0            |85000.0        |0.0            |0.0            |0.0            |0.0            |0.0              |32000.0          |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480000054001699VY|2016-10-31 00:00:00|2016-12-31 00:00:00|001   |0.0            |43000.0        |0.0            |0.0            |0.0            |0.0            |0.0              |31000.0          |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480000054001699VY|2016-08-31 00:00:00|2016-10-31 00:00:00|001   |0.0            |62000.0        |0.0            |0.0            |0.0            |0.0            |0.0              |33000.0          |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n|ES0480000054001699VY|2016-06-30 00:00:00|2016-08-31 00:00:00|001   |0.0            |156000.0       |0.0            |0.0            |0.0            |0.0            |0.0              |34000.0          |0.0              |0.0              |0.0              |0.0              |0.0     |0.0     |0.0     |0.0     |0.0     |0.0     |null                  |null             |\n+--------------------+-------------------+-------------------+------+---------------+---------------+---------------+---------------+---------------+---------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+--------+--------+--------+--------+--------+--------+----------------------+-----------------+\nonly showing top 20 rows"}]},"apps":[],"jobName":"paragraph_1684337325726_-1456617498","id":"20230517-172845_1716640976","dateCreated":"2023-05-17T17:28:45+0200","dateStarted":"2023-05-23T10:24:05+0200","dateFinished":"2023-05-23T10:24:06+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:651"},{"text":"%md\n###Extract and Transformation of **supply points (ps)** for CNMC","user":"anonymous","dateUpdated":"2023-05-23T10:26:37+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Extract and Transformation of <strong>supply points (ps)</strong> for CNMC</h3>\n"}]},"apps":[],"jobName":"paragraph_1684830380004_569876722","id":"20230523-102620_2078197528","dateCreated":"2023-05-23T10:26:20+0200","dateStarted":"2023-05-23T10:26:37+0200","dateFinished":"2023-05-23T10:26:37+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:652"},{"text":"%spark\nval cnmPsPathRaw = \"/user/training/adriana/raw/CNMC/201712_SIPS2_PS_ELECTRICIDAD_nacional.csv\"","user":"anonymous","dateUpdated":"2023-05-23T10:28:12+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"cnmPsPathRaw: String = /user/training/adriana/raw/CNMC/201712_SIPS2_PS_ELECTRICIDAD_nacional.csv"}]},"apps":[],"jobName":"paragraph_1684830400133_-911561185","id":"20230523-102640_2008319422","dateCreated":"2023-05-23T10:26:40+0200","dateStarted":"2023-05-23T10:28:12+0200","dateFinished":"2023-05-23T10:28:14+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:653"},{"text":"%spark\nval schemaPS = StructType (Array(\n  StructField(\"coddist\", StringType, false),\n  StructField(\"cups\", StringType, false),  \n  StructField(\"distribuidora\", StringType, false),\n  StructField(\"codigoPostalPS\", StringType, false),\n  StructField(\"municipioPS\", StringType, false),\n  StructField(\"codigoProvinciaPS\", StringType, false),\n  StructField(\"falta\", TimestampType, false),\n  StructField(\"tarifa\", StringType, false),\n  StructField(\"tensionps\", IntegerType, false),\n  StructField(\"potmaxbie\", StringType, false),\n  StructField(\"potenciaMaximaAPMW\", StringType, false),\n  StructField(\"codigoClasificacionPS\", StringType, false),\n  StructField(\"codigoDisponibilidadICP\", StringType, false),\n  StructField(\"perfilree\", StringType, false),\n  StructField(\"derext\", DoubleType, false),\n  StructField(\"deraccll\", DoubleType, false),\n  StructField(\"codigoPropiedadEquipoMedida\", StringType, false),\n  StructField(\"codigoPropiedadICP\", StringType, false),\n  StructField(\"potcontrp1\", DoubleType, false),\n  StructField(\"potcontrp2\", DoubleType, false),\n  StructField(\"potcontrp3\", DoubleType, false),\n  StructField(\"potcontrp4\", DoubleType, false),\n  StructField(\"potcontrp5\", DoubleType, false),\n  StructField(\"potcontrp6\", DoubleType, false),\n  StructField(\"fechaUltimoMovimientoContrato\", StringType, false),\n  StructField(\"fechaUltimoCambioComercializador\", StringType, false),\n  StructField(\"fechaLimiteDerechosReconocidos\", StringType, false),\n  StructField(\"fechaUltimaLectura\", StringType, false),\n  StructField(\"informacionImpagos\", StringType, false),\n  StructField(\"importeDepositoGarantiaEuros\", StringType, false),\n  StructField(\"tipoIdTitular\", StringType, false),\n  StructField(\"esViviendaHabitual\", StringType, false),\n  StructField(\"codigoComercializadora\", StringType, false),\n  StructField(\"codigoTelegestion\", StringType, false),\n  StructField(\"fases\", StringType, false),\n  StructField(\"autoconsumo\", StringType, false),\n  StructField(\"codigoTipoContrato\", StringType, true),\n  StructField(\"codigoPeriodicidadFacturacion\", StringType, true),\n  StructField(\"codigoBIE\", StringType, true),\n  StructField(\"fechaEmisionBIE\", StringType, true),\n  StructField(\"fechaCaducidadBIE\", StringType, true),\n  StructField(\"codigoAPM\", StringType, true),\n  StructField(\"fechaEmisionAPM\", StringType, true),\n  StructField(\"fechaCaducidadAPM\", StringType, true),\n  StructField(\"relacionTransformacionIntensidad\", StringType, true),\n  StructField(\"CNAE\", StringType, true),\n  StructField(\"codigoModoControlPotencia\", StringType, true),\n  StructField(\"potenciaCGPW\", StringType, true),\n  StructField(\"codigoDHEquipoDeMedida\", StringType, true),\n  StructField(\"codigoAccesibilidadContador\", StringType, true),\n  StructField(\"codigoPSContratable\", StringType, true),\n  StructField(\"motivoEstadoNoContratable\", StringType, true),\n  StructField(\"codigoTensionMedida\", StringType, true),\n  StructField(\"codigoClaseExpediente\", StringType, true),\n  StructField(\"codigoMotivoExpediente\", StringType, true),\n  StructField(\"codigoTipoSuministro\", StringType, true),\n  StructField(\"aplicacionBonoSocial\", StringType, false)\n  ))","user":"anonymous","dateUpdated":"2023-05-23T10:28:49+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"schemaPS: org.apache.spark.sql.types.StructType = StructType(StructField(coddist,StringType,false), StructField(cups,StringType,false), StructField(distribuidora,StringType,false), StructField(codigoPostalPS,StringType,false), StructField(municipioPS,StringType,false), StructField(codigoProvinciaPS,StringType,false), StructField(falta,TimestampType,false), StructField(tarifa,StringType,false), StructField(tensionps,IntegerType,false), StructField(potmaxbie,StringType,false), StructField(potenciaMaximaAPMW,StringType,false), StructField(codigoClasificacionPS,StringType,false), StructField(codigoDisponibilidadICP,StringType,false), StructField(perfilree,StringType,false), StructField(derext,DoubleType,false), StructField(deraccll,DoubleType,false), StructField(codigoPropiedadEquipoMedida,..."}]},"apps":[],"jobName":"paragraph_1684830410154_-1618898981","id":"20230523-102650_1889173873","dateCreated":"2023-05-23T10:26:50+0200","dateStarted":"2023-05-23T10:28:49+0200","dateFinished":"2023-05-23T10:28:50+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:654"},{"text":"%spark\nval cnmcPsDF = spark.read.schema(schemaPS).option(\"header\", \"true\").csv(cnmPsPathRaw)","user":"anonymous","dateUpdated":"2023-05-23T10:29:27+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"cnmcPsDF: org.apache.spark.sql.DataFrame = [coddist: string, cups: string ... 55 more fields]"}]},"apps":[],"jobName":"paragraph_1684830408922_1708998960","id":"20230523-102648_37456854","dateCreated":"2023-05-23T10:26:48+0200","dateStarted":"2023-05-23T10:29:27+0200","dateFinished":"2023-05-23T10:29:28+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:655"},{"text":"%spark\ncnmcPsDF.printSchema()","user":"anonymous","dateUpdated":"2023-05-23T11:08:07+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- coddist: string (nullable = true)\n |-- cups: string (nullable = true)\n |-- distribuidora: string (nullable = true)\n |-- codigoPostalPS: string (nullable = true)\n |-- municipioPS: string (nullable = true)\n |-- codigoProvinciaPS: string (nullable = true)\n |-- falta: timestamp (nullable = true)\n |-- tarifa: string (nullable = true)\n |-- tensionps: integer (nullable = true)\n |-- potmaxbie: string (nullable = true)\n |-- potenciaMaximaAPMW: string (nullable = true)\n |-- codigoClasificacionPS: string (nullable = true)\n |-- codigoDisponibilidadICP: string (nullable = true)\n |-- perfilree: string (nullable = true)\n |-- derext: double (nullable = true)\n |-- deraccll: double (nullable = true)\n |-- codigoPropiedadEquipoMedida: string (nullable = true)\n |-- codigoPropiedadICP: string (nullable = true)\n |-- potcontrp1: double (nullable = true)\n |-- potcontrp2: double (nullable = true)\n |-- potcontrp3: double (nullable = true)\n |-- potcontrp4: double (nullable = true)\n |-- potcontrp5: double (nullable = true)\n |-- potcontrp6: double (nullable = true)\n |-- fechaUltimoMovimientoContrato: string (nullable = true)\n |-- fechaUltimoCambioComercializador: string (nullable = true)\n |-- fechaLimiteDerechosReconocidos: string (nullable = true)\n |-- fechaUltimaLectura: string (nullable = true)\n |-- informacionImpagos: string (nullable = true)\n |-- importeDepositoGarantiaEuros: string (nullable = true)\n |-- tipoIdTitular: string (nullable = true)\n |-- esViviendaHabitual: string (nullable = true)\n |-- codigoComercializadora: string (nullable = true)\n |-- codigoTelegestion: string (nullable = true)\n |-- fases: string (nullable = true)\n |-- autoconsumo: string (nullable = true)\n |-- codigoTipoContrato: string (nullable = true)\n |-- codigoPeriodicidadFacturacion: string (nullable = true)\n |-- codigoBIE: string (nullable = true)\n |-- fechaEmisionBIE: string (nullable = true)\n |-- fechaCaducidadBIE: string (nullable = true)\n |-- codigoAPM: string (nullable = true)\n |-- fechaEmisionAPM: string (nullable = true)\n |-- fechaCaducidadAPM: string (nullable = true)\n |-- relacionTransformacionIntensidad: string (nullable = true)\n |-- CNAE: string (nullable = true)\n |-- codigoModoControlPotencia: string (nullable = true)\n |-- potenciaCGPW: string (nullable = true)\n |-- codigoDHEquipoDeMedida: string (nullable = true)\n |-- codigoAccesibilidadContador: string (nullable = true)\n |-- codigoPSContratable: string (nullable = true)\n |-- motivoEstadoNoContratable: string (nullable = true)\n |-- codigoTensionMedida: string (nullable = true)\n |-- codigoClaseExpediente: string (nullable = true)\n |-- codigoMotivoExpediente: string (nullable = true)\n |-- codigoTipoSuministro: string (nullable = true)\n |-- aplicacionBonoSocial: string (nullable = true)"}]},"apps":[],"jobName":"paragraph_1684830541347_-434302097","id":"20230523-102901_1129048262","dateCreated":"2023-05-23T10:29:01+0200","dateStarted":"2023-05-23T11:08:07+0200","dateFinished":"2023-05-23T11:08:08+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:656"},{"text":"%spark\n//check for duplicates\ncnmcPsDF.count()\ncnmcPsDF.dropDuplicates().count()\n","user":"anonymous","dateUpdated":"2023-05-23T11:08:10+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res154: Long = 75789\nres155: Long = 75789"}]},"apps":[],"jobName":"paragraph_1684830580756_-1340344854","id":"20230523-102940_1362932490","dateCreated":"2023-05-23T10:29:40+0200","dateStarted":"2023-05-23T11:08:11+0200","dateFinished":"2023-05-23T11:08:17+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:657"},{"text":"%md\n###Data dump in parquet format in HDFS\n","user":"anonymous","dateUpdated":"2023-05-23T11:39:13+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Data dump in parquet format in HDFS</h3>\n"}]},"apps":[],"jobName":"paragraph_1684337386803_1344049849","id":"20230517-172946_36626965","dateCreated":"2023-05-17T17:29:46+0200","dateStarted":"2023-05-23T11:39:13+0200","dateFinished":"2023-05-23T11:39:13+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:658"},{"text":"%spark\nval cnmcConsumptionPathRefined = \"/user/training/adriana/refined/Cnmc_consumption/\"\nval cnmcPsPathRefined = \"/user/training/adriana/refined/Cnmc_ps/\"","user":"anonymous","dateUpdated":"2023-05-23T11:08:53+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","editorHide":false,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"cnmcConsumptionPathRefined: String = /user/training/adriana/refined/Cnmc_consumption/\ncnmcPsPathRefined: String = /user/training/adriana/refined/Cnmc_ps/"}]},"apps":[],"jobName":"paragraph_1684346424118_-1073063887","id":"20230517-200024_2106720678","dateCreated":"2023-05-17T20:00:24+0200","dateStarted":"2023-05-23T11:08:53+0200","dateFinished":"2023-05-23T11:08:54+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:659"},{"text":"%spark\ncnmcConsumptionDFclean.write.format(\"parquet\").mode(\"overwrite\").save(cnmcConsumptionPathRefined)","user":"anonymous","dateUpdated":"2023-05-23T10:24:34+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1684345875616_-2009352408","id":"20230517-195115_165900151","dateCreated":"2023-05-17T19:51:15+0200","dateStarted":"2023-05-23T10:24:34+0200","dateFinished":"2023-05-23T10:24:48+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:660"},{"text":"%spark\ncnmcPsDF.write.format(\"parquet\").mode(\"overwrite\").save(cnmcPsPathRefined)\n","user":"anonymous","dateUpdated":"2023-05-23T11:09:48+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1684832912208_818727293","id":"20230523-110832_197683235","dateCreated":"2023-05-23T11:08:32+0200","dateStarted":"2023-05-23T11:09:48+0200","dateFinished":"2023-05-23T11:09:51+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:661"},{"text":"%spark\n","user":"anonymous","dateUpdated":"2023-05-23T11:40:17+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1684834817477_-555643721","id":"20230523-114017_1175644758","dateCreated":"2023-05-23T11:40:17+0200","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:662"}],"name":"Caso_practico/silver/ETL_cnmc","id":"2J2JXNGFT","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"sh:shared_process":[],"livy:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}